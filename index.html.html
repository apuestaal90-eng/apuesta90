<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>âš½ Apuesta al 90 â€” Dashboard en Vivo</title>

<script>
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  //  ğŸ”¥ FIREBASE â€” CONFIGURADO
  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  const FIREBASE_URL    = "https://apuesta-al-90-15300-default-rtdb.firebaseio.com";
  const FIREBASE_SECRET = "p3yH8WCVejRXspNg3oIo6uRDr4A2jH8yRuY9RNMc";
  const REFRESH_CADA    = 30; // segundos entre actualizaciones
</script>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow+Condensed:wght@300;400;500;600;700;900&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">

<style>
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
:root{
  --verde:    #00ff87;
  --verde2:   #00c864;
  --azul-bg:  #050a12;
  --azul-card:#0b1623;
  --azul-b:   #112236;
  --azul-h:   #0f2035;
  --texto:    #cde0f5;
  --gris:     #4a6580;
  --amarillo: #ffd600;
  --rojo:     #ff3d5a;
  --naranja:  #ff8c00;
  --cyan:     #00c8ff;
  --blanco:   #ffffff;
}
html,body{background:var(--azul-bg);color:var(--texto);font-family:'Barlow',sans-serif;min-height:100vh;overflow-x:hidden}
body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
  background:
    radial-gradient(ellipse 60% 40% at 15% 10%,rgba(0,255,135,.05) 0%,transparent 60%),
    radial-gradient(ellipse 50% 60% at 85% 90%,rgba(0,200,255,.04) 0%,transparent 60%),
    repeating-linear-gradient(0deg,transparent,transparent 60px,rgba(255,255,255,.012) 60px,rgba(255,255,255,.012) 61px),
    repeating-linear-gradient(90deg,transparent,transparent 60px,rgba(255,255,255,.012) 60px,rgba(255,255,255,.012) 61px)}

/* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.header{position:relative;z-index:10;padding:24px 28px 0;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px}
.brand{display:flex;align-items:center;gap:14px}
.brand-icon{width:48px;height:48px;border-radius:14px;background:linear-gradient(135deg,var(--verde),var(--cyan));display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 0 28px rgba(0,255,135,.35);animation:pulseGlow 3s ease-in-out infinite}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 28px rgba(0,255,135,.35)}50%{box-shadow:0 0 50px rgba(0,255,135,.65)}}
.brand-title{font-family:'Bebas Neue',sans-serif;font-size:2.4rem;letter-spacing:3px;background:linear-gradient(90deg,var(--verde),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;line-height:1}
.brand-sub{font-family:'Barlow Condensed',sans-serif;font-size:.75rem;letter-spacing:4px;text-transform:uppercase;color:var(--gris);margin-top:2px}
.header-right{display:flex;align-items:center;gap:16px;flex-wrap:wrap}
.jornada-pill{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:.8rem;letter-spacing:3px;text-transform:uppercase;color:var(--verde);background:rgba(0,255,135,.08);border:1px solid rgba(0,255,135,.22);padding:6px 18px;border-radius:50px}
.live-pill{display:flex;align-items:center;gap:6px;font-family:'Barlow Condensed',sans-serif;font-size:.75rem;letter-spacing:2px;color:var(--gris)}
.dot-live{width:7px;height:7px;background:var(--verde);border-radius:50%;animation:blink 1.5s ease-in-out infinite}
@keyframes blink{0%,100%{opacity:1;transform:scale(1)}50%{opacity:.3;transform:scale(.7)}}
.countdown{font-family:'Barlow Condensed',sans-serif;font-size:.72rem;color:var(--gris);letter-spacing:1px;min-width:56px;text-align:right}

/* â”€â”€ DIVIDER & LABELS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.divider{height:1px;margin:18px 28px;background:linear-gradient(90deg,transparent,var(--azul-b) 20%,var(--azul-b) 80%,transparent);position:relative;z-index:10}
.sec-label{font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:.68rem;letter-spacing:5px;text-transform:uppercase;color:var(--gris);padding:0 28px;margin-bottom:14px;position:relative;z-index:10}

/* â”€â”€ PARTIDOS GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.partidos-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:11px;padding:0 28px;position:relative;z-index:10}

/* â”€â”€ CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.card{background:var(--azul-card);border:1px solid var(--azul-b);border-radius:16px;padding:18px;position:relative;overflow:hidden;transition:transform .2s,border-color .2s,box-shadow .2s;animation:fadeUp .5s ease backwards}
.card:hover{transform:translateY(-3px);border-color:rgba(0,255,135,.18);box-shadow:0 10px 36px rgba(0,0,0,.45)}
.card::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:linear-gradient(90deg,transparent,var(--azul-b),transparent);transition:background .3s}
.card.vivo::before{background:linear-gradient(90deg,transparent,var(--rojo),transparent);animation:scan 2s linear infinite}
.card.fin::before{background:linear-gradient(90deg,transparent,var(--verde2),transparent)}
@keyframes scan{0%,100%{opacity:1}50%{opacity:.4}}
@keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}
.card-num{position:absolute;top:12px;right:14px;font-family:'Bebas Neue',sans-serif;font-size:1.7rem;color:rgba(255,255,255,.04);pointer-events:none}

/* status */
.status-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
.badge{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:.68rem;letter-spacing:2.5px;text-transform:uppercase;padding:4px 10px;border-radius:50px;display:flex;align-items:center;gap:5px}
.badge.p{background:rgba(74,101,128,.18);color:var(--gris);border:1px solid rgba(74,101,128,.28)}
.badge.v{background:rgba(255,61,90,.14);color:var(--rojo);border:1px solid rgba(255,61,90,.28)}
.badge.v .bd{width:6px;height:6px;background:var(--rojo);border-radius:50%;animation:blink 1s infinite;display:inline-block}
.badge.f{background:rgba(0,200,100,.1);color:var(--verde2);border:1px solid rgba(0,200,100,.22)}
.min-txt{font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:.75rem;color:var(--rojo);letter-spacing:1px}

/* equipos */
.eq-row{display:flex;align-items:center;justify-content:space-between;gap:8px}
.equipo{display:flex;flex-direction:column;align-items:center;gap:8px;flex:1;text-align:center}
.eq-logo{width:54px;height:54px;object-fit:contain;filter:drop-shadow(0 2px 8px rgba(0,0,0,.6));transition:transform .2s}
.card:hover .eq-logo{transform:scale(1.1)}
.eq-fallback{width:54px;height:54px;background:linear-gradient(135deg,#112236,#1a3550);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:1.5rem;border:2px solid var(--azul-b)}
.eq-nombre{font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:.78rem;letter-spacing:.5px;text-transform:uppercase;color:var(--texto);line-height:1.2;max-width:88px}

/* marcador */
.mc{display:flex;flex-direction:column;align-items:center;gap:4px;min-width:80px}
.score{font-family:'Bebas Neue',sans-serif;font-size:2.8rem;letter-spacing:4px;line-height:1;color:var(--blanco)}
.score.pend{color:var(--gris);font-size:1.6rem;letter-spacing:8px}
.vs-lbl{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:.62rem;letter-spacing:4px;color:var(--gris);text-transform:uppercase}
.res-badge{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:.65rem;letter-spacing:2px;padding:3px 10px;border-radius:4px;margin-top:2px}
.res-badge.L{background:rgba(0,200,100,.14);color:var(--verde2)}
.res-badge.V{background:rgba(0,200,255,.12);color:var(--cyan)}
.res-badge.E{background:rgba(255,214,0,.12);color:var(--amarillo)}

/* fecha */
.fecha-row{margin-top:13px;padding-top:11px;border-top:1px solid var(--azul-b);display:flex;align-items:center;justify-content:center;gap:7px;font-family:'Barlow Condensed',sans-serif;font-size:.7rem;color:var(--gris);letter-spacing:1px;text-transform:uppercase}

/* â”€â”€ RANKING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.rank-section{margin-top:36px;padding:0 28px 40px;position:relative;z-index:10}
.rank-list{display:flex;flex-direction:column;gap:8px;max-width:680px}
.rank-row{display:flex;align-items:center;gap:14px;background:var(--azul-card);border:1px solid var(--azul-b);border-radius:12px;padding:13px 18px;transition:all .2s;animation:fadeUp .5s ease backwards}
.rank-row:hover{border-color:rgba(0,255,135,.14);background:var(--azul-h)}
.rank-row.r1{border-color:rgba(255,214,0,.28);background:rgba(255,214,0,.025)}
.rank-row.r2{border-color:rgba(192,192,192,.18)}
.rank-row.r3{border-color:rgba(200,120,50,.18)}
.rpos{font-family:'Bebas Neue',sans-serif;font-size:1.5rem;min-width:28px;text-align:center;color:var(--gris)}
.r1 .rpos{color:var(--amarillo)}.r2 .rpos{color:#c0c0c0}.r3 .rpos{color:#cd7f32}
.rmedal{font-size:1.1rem;min-width:22px;text-align:center}
.rnombre{font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:.95rem;letter-spacing:.5px;text-transform:uppercase;flex:1;color:var(--texto)}
.rstats{display:flex;align-items:center;gap:18px}
.rstat{display:flex;flex-direction:column;align-items:center;gap:2px}
.rnum{font-family:'Bebas Neue',sans-serif;font-size:1.35rem;line-height:1;color:var(--blanco)}
.r1 .rnum{color:var(--amarillo)}
.rlbl{font-family:'Barlow Condensed',sans-serif;font-size:.58rem;letter-spacing:2px;text-transform:uppercase;color:var(--gris)}
.rbar-wrap{width:72px;height:4px;background:rgba(255,255,255,.06);border-radius:2px;overflow:hidden}
.rbar{height:100%;border-radius:2px;background:linear-gradient(90deg,var(--verde),var(--cyan));transition:width .8s cubic-bezier(.4,0,.2,1)}
.r1 .rbar{background:linear-gradient(90deg,var(--amarillo),var(--naranja))}

/* â”€â”€ ESTADOS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.loading{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:260px;gap:18px;color:var(--gris)}
.spinner{width:38px;height:38px;border:3px solid var(--azul-b);border-top-color:var(--verde);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.err{display:flex;flex-direction:column;align-items:center;gap:10px;padding:36px;color:var(--rojo);text-align:center}
.err p{color:var(--gris);font-size:.82rem;max-width:380px}
.err code{background:rgba(255,61,90,.1);border:1px solid rgba(255,61,90,.2);padding:6px 14px;border-radius:8px;font-size:.72rem;color:var(--rojo)}

/* â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.footer{position:relative;z-index:10;text-align:center;padding:14px 28px 22px;font-family:'Barlow Condensed',sans-serif;font-size:.68rem;letter-spacing:2px;text-transform:uppercase;color:rgba(74,101,128,.45);border-top:1px solid var(--azul-b);margin:0 28px}

@media(max-width:600px){
  .header,.partidos-grid,.rank-section{padding-left:14px;padding-right:14px}
  .divider,.sec-label{margin-left:14px;margin-right:14px;padding-left:0}
  .brand-title{font-size:1.8rem}
  .partidos-grid{grid-template-columns:1fr}
  .footer{margin:0 14px}
}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="brand">
    <div class="brand-icon">âš½</div>
    <div>
      <div class="brand-title">Apuesta al 90</div>
      <div class="brand-sub">Liga MX Â· En Vivo</div>
    </div>
  </div>
  <div class="header-right">
    <div class="jornada-pill" id="jornada-label">Cargando...</div>
    <div class="live-pill"><span class="dot-live"></span> En vivo</div>
    <div class="countdown" id="countdown-txt">âŸ³ 30s</div>
  </div>
</header>

<div class="divider"></div>

<!-- PARTIDOS -->
<div class="sec-label">âš¡ Partidos</div>
<div id="partidos-wrap">
  <div class="loading"><div class="spinner"></div><span>Conectando con Firebase...</span></div>
</div>

<!-- RANKING -->
<div class="rank-section">
  <div class="sec-label" style="padding:0;margin-bottom:14px">ğŸ† Ranking</div>
  <div class="rank-list" id="ranking-wrap">
    <div class="loading" style="min-height:100px"><div class="spinner"></div></div>
  </div>
</div>

<div class="footer">Apuesta al 90 Â· Datos en tiempo real Â· Liga MX Clausura 2026</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LOGOS ESPN â€” IDs oficiales Liga MX
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const LOGOS = {
  "Cruz Azul":          "https://a.espncdn.com/i/teamlogos/soccer/500/238.png",
  "AmÃ©rica":            "https://a.espncdn.com/i/teamlogos/soccer/500/228.png",
  "America":            "https://a.espncdn.com/i/teamlogos/soccer/500/228.png",
  "Guadalajara":        "https://a.espncdn.com/i/teamlogos/soccer/500/227.png",
  "Chivas":             "https://a.espncdn.com/i/teamlogos/soccer/500/227.png",
  "Tigres UANL":        "https://a.espncdn.com/i/teamlogos/soccer/500/241.png",
  "Tigres":             "https://a.espncdn.com/i/teamlogos/soccer/500/241.png",
  "Monterrey":          "https://a.espncdn.com/i/teamlogos/soccer/500/236.png",
  "Pumas UNAM":         "https://a.espncdn.com/i/teamlogos/soccer/500/239.png",
  "Pumas":              "https://a.espncdn.com/i/teamlogos/soccer/500/239.png",
  "Toluca":             "https://a.espncdn.com/i/teamlogos/soccer/500/242.png",
  "Atlas":              "https://a.espncdn.com/i/teamlogos/soccer/500/229.png",
  "LeÃ³n":               "https://a.espncdn.com/i/teamlogos/soccer/500/234.png",
  "Leon":               "https://a.espncdn.com/i/teamlogos/soccer/500/234.png",
  "Santos Laguna":      "https://a.espncdn.com/i/teamlogos/soccer/500/240.png",
  "Santos":             "https://a.espncdn.com/i/teamlogos/soccer/500/240.png",
  "Pachuca":            "https://a.espncdn.com/i/teamlogos/soccer/500/237.png",
  "Necaxa":             "https://a.espncdn.com/i/teamlogos/soccer/500/3558.png",
  "QuerÃ©taro":          "https://a.espncdn.com/i/teamlogos/soccer/500/3948.png",
  "Queretaro":          "https://a.espncdn.com/i/teamlogos/soccer/500/3948.png",
  "FC QuerÃ©taro":       "https://a.espncdn.com/i/teamlogos/soccer/500/3948.png",
  "Puebla":             "https://a.espncdn.com/i/teamlogos/soccer/500/3949.png",
  "AtlÃ©tico San Luis":  "https://a.espncdn.com/i/teamlogos/soccer/500/6678.png",
  "Atletico San Luis":  "https://a.espncdn.com/i/teamlogos/soccer/500/6678.png",
  "San Luis":           "https://a.espncdn.com/i/teamlogos/soccer/500/6678.png",
  "JuÃ¡rez":             "https://a.espncdn.com/i/teamlogos/soccer/500/6683.png",
  "Juarez":             "https://a.espncdn.com/i/teamlogos/soccer/500/6683.png",
  "FC JuÃ¡rez":          "https://a.espncdn.com/i/teamlogos/soccer/500/6683.png",
  "FC Juarez":          "https://a.espncdn.com/i/teamlogos/soccer/500/6683.png",
  "Tijuana":            "https://a.espncdn.com/i/teamlogos/soccer/500/3952.png",
  "Xolos":              "https://a.espncdn.com/i/teamlogos/soccer/500/3952.png",
  "MazatlÃ¡n FC":        "https://a.espncdn.com/i/teamlogos/soccer/500/6680.png",
  "Mazatlan FC":        "https://a.espncdn.com/i/teamlogos/soccer/500/6680.png",
  "MazatlÃ¡n":           "https://a.espncdn.com/i/teamlogos/soccer/500/6680.png",
  "Mazatlan":           "https://a.espncdn.com/i/teamlogos/soccer/500/6680.png",
};

const EMOJI_FB = {
  "Cruz Azul":"âš¡","AmÃ©rica":"ğŸ¦…","Guadalajara":"ğŸ”´","Tigres UANL":"ğŸ¯",
  "Monterrey":"âš½","Pumas UNAM":"ğŸ¾","Toluca":"ğŸ”´","Atlas":"ğŸ¦Š","LeÃ³n":"ğŸ¦",
  "Santos Laguna":"ğŸŒŠ","Pachuca":"âš½","default":"âš½"
};

function getLogo(nombre) {
  if (!nombre) return null;
  if (LOGOS[nombre]) return LOGOS[nombre];
  const n = nombre.toLowerCase();
  for (const [k, v] of Object.entries(LOGOS)) {
    if (n.includes(k.toLowerCase()) || k.toLowerCase().includes(n)) return v;
  }
  return null;
}
function getEmoji(n) { return EMOJI_FB[n] || EMOJI_FB["default"]; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// FIREBASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function fbGet(path) {
  const r = await fetch(`${FIREBASE_URL}/${path}.json?auth=${FIREBASE_SECRET}`);
  if (!r.ok) throw new Error(`Firebase error ${r.status}: ${await r.text()}`);
  return r.json();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER PARTIDOS
// Compatible con la estructura que guarda tu Apps Script:
// jornada_actual â†’ { numero, jornada, partidos: { ESPN_ID: { local, visita, marcador, estado, resultado, minuto, fecha, hora, numero } } }
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderPartidos(jornada) {
  const wrap = document.getElementById("partidos-wrap");

  // Extraer partidos de la estructura de Firebase
  let partidos = null;
  if (jornada && jornada.partidos) {
    partidos = jornada.partidos;                // estructura normal
  } else if (jornada && typeof jornada === "object") {
    // Intentar si jornada_actual ES directamente los partidos
    const vals = Object.values(jornada);
    if (vals.length && vals[0] && (vals[0].local || vals[0].homeTeam)) {
      partidos = jornada;
    }
  }

  if (!partidos || !Object.keys(partidos).length) {
    wrap.innerHTML = sinDatos("partidos", "ACTUALIZAR_SISTEMA_TOTAL");
    return;
  }

  const lista = Object.entries(partidos).sort((a, b) => {
    return parseInt(a[1].numero || a[1].num || 99) - parseInt(b[1].numero || b[1].num || 99);
  });

  const cards = lista.map(([id, p], i) => {
    const est  = (p.estado || "").toLowerCase();
    const esV  = est === "in" || est.includes("vivo") || est.includes("live") || est.includes("progress");
    const esF  = est === "post" || est.includes("fin") || est.includes("final") || est.includes("complet");

    const local   = p.local   || p.homeTeam  || "Local";
    const visita  = p.visita  || p.awayTeam  || "Visita";
    const marc    = (p.marcador || p.score || "").toString();
    const pts     = marc.split("-");
    const gL      = pts[0]?.trim() || "0";
    const gV      = pts[1]?.trim() || "0";

    const urlL = getLogo(local);
    const urlV = getLogo(visita);

    const logoL = urlL
      ? `<img src="${urlL}" class="eq-logo" alt="${local}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
         <div class="eq-fallback" style="display:none">${getEmoji(local)}</div>`
      : `<div class="eq-fallback">${getEmoji(local)}</div>`;

    const logoV = urlV
      ? `<img src="${urlV}" class="eq-logo" alt="${visita}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
         <div class="eq-fallback" style="display:none">${getEmoji(visita)}</div>`
      : `<div class="eq-fallback">${getEmoji(visita)}</div>`;

    const statusHTML = esV
      ? `<span class="badge v"><span class="bd"></span> En Vivo</span><span class="min-txt">${p.minuto||p.tiempo||""}â€²</span>`
      : esF
      ? `<span class="badge f">âœ“ Finalizado</span>`
      : `<span class="badge p">Pendiente</span>`;

    const res = p.resultado || "";
    const resHTML = esF && res
      ? `<div class="res-badge ${res}">${res==="L"?"LOCAL":res==="V"?"VISITA":"EMPATE"}</div>` : "";

    const scoreHTML = (esV || esF) && marc
      ? `<div class="score">${gL} - ${gV}</div>${resHTML}`
      : `<div class="score pend">vs</div><div class="vs-lbl">${p.hora || ""}</div>`;

    const cls = esV ? "card vivo" : esF ? "card fin" : "card";

    return `
    <div class="${cls}" style="animation-delay:${i*.06}s">
      <div class="card-num">${String(i+1).padStart(2,"0")}</div>
      <div class="status-row">${statusHTML}</div>
      <div class="eq-row">
        <div class="equipo">${logoL}<div class="eq-nombre">${local}</div></div>
        <div class="mc">${scoreHTML}</div>
        <div class="equipo">${logoV}<div class="eq-nombre">${visita}</div></div>
      </div>
      <div class="fecha-row">
        <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" opacity=".5">
          <rect x="3" y="4" width="18" height="18" rx="2"/>
          <line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/>
          <line x1="3" y1="10" x2="21" y2="10"/>
        </svg>
        ${p.fecha || ""} ${p.hora ? "Â· " + p.hora : ""}
      </div>
    </div>`;
  });

  wrap.innerHTML = `<div class="partidos-grid">${cards.join("")}</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RENDER RANKING
// Estructura: ranking / {uid} â†’ { nombre, email, puntos, aciertos, posicion, totalPredicciones }
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderRanking(data) {
  const wrap = document.getElementById("ranking-wrap");
  if (!data || !Object.keys(data).length) {
    wrap.innerHTML = `<div style="color:var(--gris);font-family:'Barlow Condensed',sans-serif;letter-spacing:2px;text-transform:uppercase;font-size:.8rem;padding:20px 0">Sin participantes aÃºn</div>`;
    return;
  }

  const lista = Object.values(data).sort((a, b) => {
    if ((b.puntos||0) !== (a.puntos||0)) return (b.puntos||0) - (a.puntos||0);
    if ((b.aciertos||0) !== (a.aciertos||0)) return (b.aciertos||0) - (a.aciertos||0);
    return (a.nombre||"").localeCompare(b.nombre||"");
  });

  const top    = Math.max(...lista.map(u => u.puntos || 0), 1);
  const medals = ["ğŸ¥‡","ğŸ¥ˆ","ğŸ¥‰"];

  wrap.innerHTML = lista.map((u, i) => {
    const pct    = Math.round(((u.puntos||0)/top)*100);
    const rc     = i < 3 ? `r${i+1}` : "";
    const nombre = u.nombre || (u.email ? u.email.split("@")[0] : "Participante");

    return `
    <div class="rank-row ${rc}" style="animation-delay:${i*.07}s">
      <div class="rpos">${i+1}</div>
      <div class="rmedal">${medals[i]||""}</div>
      <div class="rnombre">${nombre}</div>
      <div class="rstats">
        <div class="rstat"><div class="rnum">${u.puntos||0}</div><div class="rlbl">Puntos</div></div>
        <div class="rstat"><div class="rnum">${u.aciertos||0}</div><div class="rlbl">Aciertos</div></div>
        <div class="rstat"><div class="rnum">${u.totalPredicciones||0}</div><div class="rlbl">Partidos</div></div>
        <div class="rbar-wrap"><div class="rbar" style="width:${pct}%"></div></div>
      </div>
    </div>`;
  }).join("");
}

function sinDatos(tipo, fn) {
  return `<div class="err" style="color:var(--gris)">
    <div style="font-size:2rem">ğŸ“‹</div>
    <strong style="color:var(--texto)">Sin ${tipo} en Firebase</strong>
    <p>Ejecuta <code>${fn}</code> en Apps Script para cargar los datos.</p>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CARGAR TODO DESDE FIREBASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function cargarDatos() {
  try {
    const [jornada, ranking] = await Promise.all([
      fbGet("jornada_actual"),
      fbGet("ranking")
    ]);

    // NÃºmero de jornada
    const jNum = jornada?.numero || jornada?.jornada || "";
    document.getElementById("jornada-label").textContent =
      jNum ? `Jornada ${jNum}` : "Liga MX";

    renderPartidos(jornada);
    renderRanking(ranking);

  } catch (err) {
    console.error("Error Firebase:", err);
    document.getElementById("partidos-wrap").innerHTML = `
      <div class="err">
        <div style="font-size:2rem">âš ï¸</div>
        <strong>Error de conexiÃ³n con Firebase</strong>
        <p>${err.message}</p>
        <p>AsegÃºrate que las reglas de Firebase permitan lectura:<br>
        <code>{ "rules": { ".read": true, ".write": true } }</code></p>
      </div>`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COUNTDOWN AUTO-REFRESH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let cdVal = REFRESH_CADA;
const cdEl = document.getElementById("countdown-txt");

setInterval(() => {
  cdVal--;
  cdEl.textContent = `âŸ³ ${cdVal}s`;
  if (cdVal <= 0) {
    cargarDatos();
    cdVal = REFRESH_CADA;
  }
}, 1000);

// Carga inicial
cargarDatos();
</script>
</body>
</html>
